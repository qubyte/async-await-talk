<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Drone Wars</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css" id="theme">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/github.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Drone Wars</h1>
          <h3>The 2014 @asyncjs Brighton Digital Festival Hackathon</h3>
          <p>
            <small><a href="http://hakim.se">Mark Everitt</a> / <a href="http://twitter.com/hakimel">@qubyte</a></small>
          </p>
          <aside class="notes">I'm Mark, and I'm going to talk about a hackathon I wrote and ran. I hope you enjoy it!</aside>
        </section>

        <section>
          <h2>A little about me</h2>
          <div class="flex-container">
            <img src="img/me.jpg" width="400" class="flex-element">
            <ul class="flex-element" style="padding: 50px;"><li>'06 - '12:  Quantum Info</li><li>'12 - '15:  This!</li></ul>
          </div>
          <aside class="notes">First off, a little about me. I'm what is sometimes called a full-stack engineer. Really I'm just really enthusiastic about JS. I learnt JS in the context of Node.js, so I didn't have a lot of the more horrific DOM/browesr APIs there to give me a hard time. Later on I moved to about 50-50 frontend-backend and learnt me some nginx for reverse proxying. You might be wondering how I learnt JS from Node when Node is so relatively young. Well, that's because I'm also a doctor of quantum information, which was my previous career, and useful for raising eyebrows in presentations.</aside>
        </section>

        <section>
          <h2>The hackathon</h2>
          <p>Part of the 2014 Brighton Digital Festival.</p>
          <p>Hosted by @asyncjs, the Brighton JavaScript User Group</p>
          <img src="img/tank.jpg" width="300" class="flex-element">
          <aside class="notes">Each year the Brighton JavaScript user group holds an event for the Brighton Digital Festival in the autumn. In 2014 we decided it should be a hackathon, accessible to anyone. Developers (over the whole range of experience) and designers. The idea was to form small teams to make something that looks shiny and embodies extreme malevolence.</aside>
        </section>

        <section>
          <h2>The concept</h2>
          <p>Inspired by an old project called robojs</p>
          <img src="img/robojs.gif" width="500" class="flex-element">
        </section>

        <section>
          <h2>The concept</h2>
          <p>Procedural. A little dull, and not very realistic.</p>
          <img src="img/floor-turtle.jpg" width="500" class="flex-element">
        </section>

        <section>
          <h2>The concept</h2>
          <p>Wanted something more like this guy.</p>
          <img src="img/arnie.gif" width="600" class="flex-element">
        </section>

        <section>
          <h2>The concept</h2>
          <pre><code data-trim>
importScripts('base-robot.js');

ScanBot = BaseRobot;

ScanBot.run = function() {
  this.shoot();
  this.turn_turret_right(45);

  this.move_forward(Math.random() * 400, {
    DONE: () => {
      this.shoot();
      this.turn_right(Math.random() * 90, {
        DONE: () => {
          this.shoot();
          this._run();
        }
      });
    },
    ENEMY_COLLIDE: () => {
      this.shoot();
      this.move_backward(100, {
        DONE: () => {
          this._run();
        },
        WALL_COLLIDE: () => {
          this._run();
        }
      });
    },
    WALL_COLLIDE: () => {
      this.turn_left(180, {
        DONE: () => {
          this.shoot();
          this._run();
        }
      });
    }
  });
}
          </code></pre>
        </section>

        <section>
          <h2>A Drone</h2>
          <p>What would it be like for a physical drone in an arena?</p>
          <ul>
            <li>It can know about the locations and speeds of things around it...</li>
            <li>It can accelerate in any direction...</li>
            <li>It can shoot at a location...</li>
            <li>It can know how fast projectiles move...</li>
            <li>It can know how much damage it has taken</li>
            <li><i>and nothing else!</i></li>
          </ul>
          <aside class="notes">If we were building an automatic robot for something like robot wars, what information would it have access to? As it turns out, not an awful lot. It can know where things around it are and how fast they are moving. It can accelerate, and it can shoot. That's really not all that much, but when you think about it, that's the sort of information anyone driving a tank would have. Using only this information, a tank has to choose its actions. That would be the primary challenge for attendees - to write code that would be sandboxed in a web worker, like a brain sandboxed in a skull driving a body.
Web workers are separate threads, so they come with some added benefits... If you code something slow, then it's going to be slow to react to changing conditions. It also avoids all the robots thinking from impacting the render loop.
A drone consists of two parts. The body is spawned by the battlefield, and contains all the state of a drone. This code is the same for all combatants. Each drone will spawn its custom brain and load its own graphical assets. The brain can ask the body what is going on in and around itself, and the body can tell these things to the brain. The brain has no control over the state of the body beyond accelerating it in some direction.
          </aside>
        </section>

        <section>
          <h2>cortex</h2>
          <p>Script to run in worker for convenience functions:</p>
          <ul>
            <li>cortex.log</li>
            <li>cortex.init</li>
            <li>contex.Queue</li>
          </ul>
        </section>

        <section>
          <h2>cortex.init</h2>
          <code><pre>
cortex.init(function decider(data, callback) {
  // Decide what to do based on data;
  // Pass an error to the callback to log an issue with the decider.

  callback(null, decision);
});
          </code></pre>
        </section>

        <section>
          <h2>Turret example</h2>
          <code><pre>
importScripts('/scripts/brains/cortex.js');

cortex.init(function decider(data, callback) {
  let {robot, token, status: {robots}} = data;
  let enemyIds = Object.keys(robots).filter(id => id !== robot.id);

  callback(null, {
    token,
    acceleration: {x: 0, y: 0},
    fire: robots[enemyIds[0]].position
  });
});
          </pre></code>
        </section>

        <section data-state="turret-example">
          <h2>Turret example</h2>
          <canvas style="border: 1px solid black;" width="600" height="600" id="turret-example-canvas"></canvas>
        </section>

        <section>
          <h2>The Battlefield</h2>
          <p>This is the code running in the main thread.</p>
          <p>Contains robots and projectiles.</p>
          <p>Generative landscape (wanted to do more on this but ran out of time).</p>
          <aside class="notes">What I call the battlefield is the code that runs in the main JS thread. It's renders a canvas containing the visual battlefield and the drone bodies. It spawns robots and projectiles. Essentially it handles the state and rendering of the battle, and that's about it.</aside>
        </section>

        <section>
          <h2>The server</h2>
          <aside class="notes">The server runs on node (of course). It compiles the browser code using browserify with a few extra tricks I threw in. It needed to be runnable from the attendees machines for development purposes, so I made sure the only thing needed was Node. Since some of the attendees would be bringing windows machines, I could not rely on binary modules, so pure JS only..</aside>
        </section>

        <section>
          <h2>The Event</h2>
          <aside class="notes">The event itself was held over two evening, with each session around 2.5 hours. Beer and pizzas were provided by the sponsor, and that ensured a healthy turnout. We learnt a few things. Firstly, don't rely on a network to be sane. It turned out we couldn't host a service locally, so we had to quickly spin up a digital ocean droplet to do this for us. </aside>
        </section>

        <section>
          <h2>Thoughts</h2>
        </section>

        <section>
          <h2>If we have time...</h2>
          <code><pre>
let MyClass = () => {
  let privateData = new WeakMap();

  function privateMethod(instance) {
      let privateData = privateData.get(instance);

      // Do something with private data;
  }

  return class MyClass {
    constructor() {
      privateData.set(this, {});
    }

    someMethod() {
      let private = privateData.get(this);

      // Do something with private data;
    }

    someOtherMethod() {
        return privateMethod(this);
    }
  }
}();
          </pre></code>
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script src="lib/robots/scripts/bundle.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

    <script>
      var canvas = document.getElementById('turret-example-canvas');

      var turretDef = {
        position: {
          x: Math.round(canvas.width / 2),
          y: Math.round(canvas.height / 2)
        },
        velocity: {
          x: 0,
          y: 0
        },
        name: 'shooter',
        src: 'lib/robots/scripts/brains/example_01_shooter.js',
        body: 'lib/robots/img/body2.png',
        turret: 'lib/robots/img/turret2.png'
      };

      var orbiterDef = {
        position: {
          x: Math.round(canvas.width / 2),
          y: Math.round(canvas.height / 2) - 150
        },
        velocity: {
          x: 0.1,
          y: 0
        },
        maxAcceleration: 0.00005,
        name: 'orbiter',
        src: 'lib/robots/scripts/brains/example_01_orbiter.js',
        body: 'lib/robots/img/body3.png',
        turret: 'lib/robots/img/turret3.png'
      };

      Reveal.addEventListener('turret-example', function() {
        var battlefield = examples[0](canvas, turretDef, orbiterDef);

        window.addEventListener('hashchange', function() {
          //battlefield.stop();
        }, false);
      }, false );
    </script>
  </body>
</html>
